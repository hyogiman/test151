<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì—”ì§€ë‹ˆì–´ êµìœ¡ ê²Œì„</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 30px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            max-width: 900px;
            margin: 0 auto;
        }

        .title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .subtitle {
            font-size: 1rem;
            color: #7f8c8d;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }

        .message-display {
            font-size: 1.4rem;
            font-weight: 500;
            color: #2c3e50;
            margin: 20px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.5;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .button:active {
            transform: translateY(0);
        }

        .reset-button {
            background: #e74c3c;
        }

        .reset-button:hover {
            background: #c0392b;
        }

        .edit-button {
            background: #f39c12;
        }

        .edit-button:hover {
            background: #e67e22;
        }

        .message-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }

        .message-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            text-align: left;
            font-size: 0.9rem;
            line-height: 1.4;
            position: relative;
            padding-right: 100px;
        }

        .message-item.active {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }

        .admin-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            width: 100%;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .status-info {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .status-info h3 {
            color: #2e7d32;
            margin: 0 0 15px 0;
            font-size: 1.2rem;
        }

        .status-info p {
            color: #388e3c;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .participants-list {
            margin-top: 15px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }

        .participants-list h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .team-group {
            margin: 8px 0;
            padding: 8px;
            background: #f0f8f0;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .team-group strong {
            color: #2e7d32;
        }

        .participant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .participant-info {
            flex: 1;
        }

        .participant-actions {
            display: flex;
            gap: 5px;
        }

        .participant-management {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8f0;
            border-radius: 6px;
            border: 1px solid #4caf50;
        }

        .participant-management h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .management-controls, .message-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .small-button {
            padding: 8px 16px;
            font-size: 0.85rem;
            margin: 0;
        }

        .mini-button {
            padding: 4px 8px;
            font-size: 0.7rem;
            margin: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .message-item .message-actions {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
        }

        .loading-indicator {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .title {
                font-size: 1.6rem;
            }
            
            .message-display {
                font-size: 1.2rem;
                min-height: 60px;
                padding: 15px;
            }
            
            .button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .message-list {
                max-height: 200px;
            }

            .message-item {
                padding-right: 10px;
            }

            .message-item .message-actions {
                position: static;
                transform: none;
                margin-top: 10px;
                justify-content: flex-end;
            }

            .participant-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .participant-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ê´€ë¦¬ì í˜ì´ì§€</h1>
        
        <div class="status-info">
            <h3>ğŸ“Š í˜„ì¬ ìƒíƒœ</h3>
            <p>ì°¸ê°€ì í™”ë©´: <a href="index.html" target="_blank">index.html</a></p>
            <p>ì°¸ê°€ìë“¤ì´ ìœ„ ë§í¬ë¡œ ì ‘ì†í•˜ì—¬ íŒ€ëª…ê³¼ ì‚¬ë²ˆì„ ì…ë ¥í•œ í›„ ì œì‹œë¬¸ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <p>í˜„ì¬ í™œì„± ì°¸ê°€ì ìˆ˜: <span id="active-participants-count">í™•ì¸ ì¤‘...</span></p>
            <div id="participants-list" class="participants-list"></div>
            
            <!-- ì°¸ê°€ì ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="participant-management">
                <h4>ğŸ‘¥ ì°¸ê°€ì ê´€ë¦¬</h4>
                <div class="management-controls">
                    <button class="button small-button" onclick="showAddParticipantForm()">â• ì°¸ê°€ì ì¶”ê°€</button>
                    <button class="button small-button reset-button" onclick="clearAllParticipants()">ğŸ—‘ï¸ ëª¨ë“  ì°¸ê°€ì ì‚­ì œ</button>
                </div>
            </div>
        </div>
        
        <div class="admin-controls">
            <div class="message-list">
                <h3>ğŸ“‹ ì œì‹œë¬¸ ëª©ë¡ (ì´ <span id="message-count">ë¡œë”© ì¤‘...</span>ê°œ)</h3>
                <div class="message-controls">
                    <button class="button small-button" onclick="showAddMessageForm()">â• ì œì‹œë¬¸ ì¶”ê°€</button>
                    <button class="button small-button reset-button" onclick="resetToDefaultMessages()">ğŸ”„ ê¸°ë³¸ ì œì‹œë¬¸ìœ¼ë¡œ ë³µì›</button>
                </div>
                <div id="message-list">
                    <div class="loading-indicator">ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <div class="button-group">
                <button class="button" onclick="showRandomMessage()">
                    ğŸ² ëœë¤ ë©”ì‹œì§€ í‘œì‹œ
                </button>
                <button class="button reset-button" onclick="resetMessage()">
                    ğŸ”„ í™”ë©´ ë¦¬ì…‹
                </button>
            </div>

            <div id="current-message-display" style="display: none;">
                <h3>ğŸ“º í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë©”ì‹œì§€:</h3>
                <div class="message-display" id="admin-current-message"></div>
            </div>
        </div>
    </div>

    <!-- ì°¸ê°€ì ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addParticipantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">â• ì°¸ê°€ì ì¶”ê°€</span>
                <span class="close" onclick="closeModal('addParticipantModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="newTeam">íŒ€ëª…:</label>
                <input type="text" id="newTeam" placeholder="íŒ€ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="newEmployee">ì‚¬ë²ˆ:</label>
                <input type="text" id="newEmployee" placeholder="ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="modal-buttons">
                <button class="button" onclick="addParticipant()">ì¶”ê°€</button>
                <button class="button reset-button" onclick="closeModal('addParticipantModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì°¸ê°€ì ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editParticipantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">âœï¸ ì°¸ê°€ì ìˆ˜ì •</span>
                <span class="close" onclick="closeModal('editParticipantModal')">&times;</span>
            </div>
            <input type="hidden" id="editParticipantId">
            <div class="form-group">
                <label for="editTeam">íŒ€ëª…:</label>
                <input type="text" id="editTeam" placeholder="íŒ€ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="editEmployee">ì‚¬ë²ˆ:</label>
                <input type="text" id="editEmployee" placeholder="ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="modal-buttons">
                <button class="button" onclick="updateParticipant()">ìˆ˜ì •</button>
                <button class="button reset-button" onclick="closeModal('editParticipantModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì œì‹œë¬¸ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addMessageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">â• ì œì‹œë¬¸ ì¶”ê°€</span>
                <span class="close" onclick="closeModal('addMessageModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="newMessage">ì œì‹œë¬¸:</label>
                <textarea id="newMessage" placeholder="ìƒˆë¡œìš´ ì œì‹œë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="button" onclick="addMessage()">ì¶”ê°€</button>
                <button class="button reset-button" onclick="closeModal('addMessageModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì œì‹œë¬¸ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editMessageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">âœï¸ ì œì‹œë¬¸ ìˆ˜ì •</span>
                <span class="close" onclick="closeModal('editMessageModal')">&times;</span>
            </div>
            <input type="hidden" id="editMessageId">
            <div class="form-group">
                <label for="editMessageText">ì œì‹œë¬¸ ë‚´ìš©:</label>
                <textarea id="editMessageText" placeholder="ì œì‹œë¬¸ì„ ìˆ˜ì •í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="button" onclick="updateMessage()">ìˆ˜ì •</button>
                <button class="button reset-button" onclick="closeModal('editMessageModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyB2NNdceq5AGojaGgQ-i9t4dxPU-ccecDc",
            authDomain: "tst1121-6983e.firebaseapp.com",
            projectId: "tst1121-6983e",
            storageBucket: "tst1121-6983e.firebasestorage.app",
            messagingSenderId: "84052633103",
            appId: "1:84052633103:web:deb08e91dfa199a524e57a",
            measurementId: "G-8Q971YBLLE"
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ì»¬ë ‰ì…˜ ì´ë¦„
        const participantsCollection = 'participants';
        const messagesCollection = 'messages';
        const systemMessagesCollection = 'systemMessages';

        // ê¸°ë³¸ ë©”ì‹œì§€ (ì´ˆê¸°í™”ìš©)
        const defaultMessages = [
            "íš¨ìœ¨ì ì¸ ì½”ë“œ ë¦¬ë·° í”„ë¡œì„¸ìŠ¤ë¥¼ ì„¤ê³„í•´ë³´ì„¸ìš”",
            "ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì¥ë‹¨ì ì„ ë¶„ì„í•´ë³´ì„¸ìš”",
            "ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ìµœì í™” ì „ëµì„ ì œì‹œí•´ë³´ì„¸ìš”",
            "ë³´ì•ˆ ì·¨ì•½ì ì„ ì°¾ì•„ë‚´ëŠ” ë°©ë²•ì„ ì„¤ëª…í•´ë³´ì„¸ìš”",
            "ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ëŠ” UI/UX ì„¤ê³„ ì›ì¹™ì„ ì„¤ëª…í•´ë³´ì„¸ìš”",
            "í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ë°©ë²•ë¡ ì„ ì„¤ëª…í•´ë³´ì„¸ìš”",
            "DevOps íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ëŠ” ë‹¨ê³„ë³„ ë°©ë²•ì„ ì œì‹œí•´ë³´ì„¸ìš”",
            "ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œìŠ¤í…œì„ ì„¤ê³„í•´ë³´ì„¸ìš”",
            "ëª¨ë°”ì¼ ì•± ì„±ëŠ¥ ìµœì í™” ê¸°ë²•ì„ ì„¤ëª…í•´ë³´ì„¸ìš”",
            "API ì„¤ê³„ì˜ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ë¥¼ ì œì‹œí•´ë³´ì„¸ìš”",
            "í…ŒìŠ¤íŠ¸ ìë™í™” ì „ëµì„ ìˆ˜ë¦½í•´ë³´ì„¸ìš”",
            "ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì‹œìŠ¤í…œì„ ì„¤ê³„í•´ë³´ì„¸ìš”",
            "ìŠ¤ì¼€ì¼ëŸ¬ë¸”í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì•„í‚¤í…ì²˜ë¥¼ ì œì•ˆí•´ë³´ì„¸ìš”",
            "ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµì„ ìˆ˜ë¦½í•´ë³´ì„¸ìš”",
            "ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬ ì‹œìŠ¤í…œì„ ì„¤ê³„í•´ë³´ì„¸ìš”"
        ];

        let messages = [];
        let currentMessage = '';
        let activeParticipants = [];
        let participantsUnsubscribe = null;
        let messageUnsubscribe = null;
        let systemMessagesUnsubscribe = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
            startFirebaseListeners();
            
            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œ
            loadSystemMessages();
        };

        // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
        function startFirebaseListeners() {
            console.log('Firebase ë¦¬ìŠ¤ë„ˆ ì‹œì‘');
            
            // í™œì„± ì°¸ê°€ì ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            participantsUnsubscribe = db.collection(participantsCollection)
                .onSnapshot((snapshot) => {
                    const participants = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        // 5ë¶„ ì´ë‚´ì— ì ‘ì†í•œ ì°¸ê°€ìë§Œ í™œì„±ìœ¼ë¡œ ê°„ì£¼
                        const timestamp = new Date(data.timestamp);
                        const now = new Date();
                        if ((now - timestamp) < 300000) { // 5ë¶„
                            participants.push(data);
                        }
                    });
                    activeParticipants = participants;
                    updateActiveParticipantsCount();
                }, (error) => {
                    console.error('ì°¸ê°€ì ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                });

            // í˜„ì¬ ë©”ì‹œì§€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            messageUnsubscribe = db.collection(messagesCollection).doc('current')
                .onSnapshot((docSnapshot) => {
                    console.log('ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ í˜¸ì¶œë¨:', docSnapshot);
                    
                    if (docSnapshot.exists) {
                        console.log('ë©”ì‹œì§€ê°€ ì¡´ì¬í•¨ - ìƒíƒœ ì—…ë°ì´íŠ¸');
                        setCurrentMessage('íŒ€ë³„ë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€ê°€ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        console.log('ë©”ì‹œì§€ê°€ ì—†ìŒ - ìƒíƒœ ì´ˆê¸°í™”');
                        setCurrentMessage('');
                    }
                }, (error) => {
                    console.error('ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                });

            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            systemMessagesUnsubscribe = db.collection(systemMessagesCollection).doc('default')
                .onSnapshot((docSnapshot) => {
                    console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ í˜¸ì¶œë¨');
                    
                    if (docSnapshot.exists) {
                        const data = docSnapshot.data();
                        messages = data.messages || [];
                        console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œë¨:', messages.length, 'ê°œ');
                    } else {
                        console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ê°€ ì—†ìŒ - ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©');
                        messages = [...defaultMessages];
                    }
                    createMessageList();
                }, (error) => {
                    console.error('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©
                    messages = [...defaultMessages];
                    createMessageList();
                });
        }

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œ
        async function loadSystemMessages() {
            try {
                console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œ ì‹œë„');
                const doc = await db.collection(systemMessagesCollection).doc('default').get();
                
                if (doc.exists) {
                    const data = doc.data();
                    messages = data.messages || [];
                    console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œ ì™„ë£Œ:', messages.length, 'ê°œ');
                } else {
                    console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ê°€ ì—†ìŒ - ì´ˆê¸°í™” í•„ìš”');
                    await initializeSystemMessages();
                }
                
                createMessageList();
            } catch (error) {
                console.error('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©
                messages = [...defaultMessages];
                createMessageList();
            }
        }

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì´ˆê¸°í™”
        async function initializeSystemMessages() {
            try {
                console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì´ˆê¸°í™” ì‹œì‘');
                await db.collection(systemMessagesCollection).doc('default').set({
                    messages: defaultMessages,
                    lastUpdated: new Date().toISOString()
                });
                messages = [...defaultMessages];
                console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                messages = [...defaultMessages];
            }
        }

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì €ì¥
        async function saveSystemMessages() {
            try {
                console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì €ì¥ ì‹œì‘');
                await db.collection(systemMessagesCollection).doc('default').set({
                    messages: messages,
                    lastUpdated: new Date().toISOString()
                });
                console.log('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì €ì¥ ì™„ë£Œ');
                return true;
            } catch (error) {
                console.error('ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ë©”ì‹œì§€ ëª©ë¡ ìƒì„±
        function createMessageList() {
            const messageList = document.getElementById('message-list');
            const messageCount = document.getElementById('message-count');
            messageList.innerHTML = '';
            
            messageCount.textContent = messages.length;
            
            if (messages.length === 0) {
                messageList.innerHTML = '<div class="loading-indicator">ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            messages.forEach((message, index) => {
                const div = document.createElement('div');
                div.className = 'message-item';
                div.innerHTML = `
                    <strong>${index + 1}.</strong> ${message}
                    <div class="message-actions">
                        <button class="button mini-button edit-button" onclick="editMessage(${index})">âœï¸</button>
                        <button class="button mini-button reset-button" onclick="deleteMessage(${index})">ğŸ—‘ï¸</button>
                    </div>
                `;
                messageList.appendChild(div);
            });
        }

        // ëœë¤ ë©”ì‹œì§€ í‘œì‹œ (íŒ€ë³„ë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€, ê°™ì€ íŒ€ ë‚´ì—ì„œëŠ” ì„œë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€)
        async function showRandomMessage() {
            console.log('showRandomMessage í˜¸ì¶œë¨');
            console.log('í˜„ì¬ í™œì„± ì°¸ê°€ì:', activeParticipants);
            
            if (activeParticipants.length === 0) {
                alert('âš ï¸ í˜„ì¬ í™œì„± ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤. ì°¸ê°€ìë“¤ì´ í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (messages.length === 0) {
                alert('âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì œì‹œë¬¸ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // íŒ€ë³„ë¡œ ê·¸ë£¹í™”
            const teamGroups = {};
            activeParticipants.forEach(participant => {
                if (!teamGroups[participant.team]) {
                    teamGroups[participant.team] = [];
                }
                teamGroups[participant.team].push(participant);
            });
            
            console.log('íŒ€ ê·¸ë£¹:', teamGroups);
            
            // ê° íŒ€ë³„ë¡œ ë©”ì‹œì§€ í• ë‹¹
            const assignedMessages = {};
            
            Object.keys(teamGroups).forEach(teamName => {
                const teamMembers = teamGroups[teamName];
                const usedMessages = new Set();
                
                teamMembers.forEach(participant => {
                    let randomIndex;
                    let attempts = 0;
                    
                    // ê°™ì€ íŒ€ ë‚´ì—ì„œ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ë©”ì‹œì§€ ì°¾ê¸°
                    do {
                        randomIndex = Math.floor(Math.random() * messages.length);
                        attempts++;
                    } while (usedMessages.has(randomIndex) && attempts < 50);
                    
                    usedMessages.add(randomIndex);
                    assignedMessages[participant.id] = messages[randomIndex];
                });
            });
            
            console.log('í• ë‹¹ëœ ë©”ì‹œì§€:', assignedMessages);
            
            try {
                // Firebaseì— ë©”ì‹œì§€ ì €ì¥
                const docRef = db.collection(messagesCollection).doc('current');
                await docRef.set({
                    assignedMessages: assignedMessages,
                    timestamp: new Date().toISOString()
                });
                
                console.log('Firebaseì— ë©”ì‹œì§€ ì €ì¥ ì™„ë£Œ');
                
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                const teamCount = Object.keys(teamGroups).length;
                alert(`âœ… ${activeParticipants.length}ëª…ì˜ ì°¸ê°€ì (${teamCount}ê°œ íŒ€)ì—ê²Œ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê°™ì€ íŒ€ ë‚´ì—ì„œëŠ” ì„œë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€ê°€, ë‹¤ë¥¸ íŒ€ë¼ë¦¬ëŠ” ê°™ì€ ë©”ì‹œì§€ê°€ í• ë‹¹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                alert('âŒ ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë©”ì‹œì§€ ë¦¬ì…‹
        async function resetMessage() {
            try {
                await db.collection(messagesCollection).doc('current').delete();
                alert('ğŸ”„ ëª¨ë“  ì°¸ê°€ì í™”ë©´ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ë©”ì‹œì§€ ë¦¬ì…‹ ì˜¤ë¥˜:', error);
                alert('âŒ ë©”ì‹œì§€ ë¦¬ì…‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í™œì„± ì°¸ê°€ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateActiveParticipantsCount() {
            const countElement = document.getElementById('active-participants-count');
            const participantsListElement = document.getElementById('participants-list');
            
            countElement.textContent = activeParticipants.length + 'ëª…';
            
            // ì°¸ê°€ì ëª©ë¡ í‘œì‹œ
            if (activeParticipants.length > 0) {
                const teamGroups = {};
                activeParticipants.forEach(participant => {
                    if (!teamGroups[participant.team]) {
                        teamGroups[participant.team] = [];
                    }
                    teamGroups[participant.team].push(participant);
                });
                
                let listHTML = '<h4>ğŸ“‹ ì°¸ê°€ì ëª©ë¡:</h4>';
                Object.keys(teamGroups).forEach(teamName => {
                    listHTML += `<div class="team-group"><strong>${teamName}</strong>:`;
                    teamGroups[teamName].forEach(participant => {
                        listHTML += `
                            <div class="participant-item">
                                <div class="participant-info">${participant.employee}</div>
                                <div class="participant-actions">
                                    <button class="button mini-button edit-button" onclick="editParticipant('${participant.id}', '${participant.team}', '${participant.employee}')">âœï¸</button>
                                    <button class="button mini-button reset-button" onclick="deleteParticipant('${participant.id}')">ğŸ—‘ï¸</button>
                                </div>
                            </div>
                        `;
                    });
                    listHTML += '</div>';
                });
                
                participantsListElement.innerHTML = listHTML;
            } else {
                participantsListElement.innerHTML = '<p style="color: #666;">í˜„ì¬ í™œì„± ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // í˜„ì¬ ë©”ì‹œì§€ ì„¤ì •
        function setCurrentMessage(message) {
            currentMessage = message;
            updateAdminDisplay();
        }

        // ê´€ë¦¬ì í™”ë©´ ì—…ë°ì´íŠ¸
        function updateAdminDisplay() {
            const adminCurrentMessage = document.getElementById('admin-current-message');
            const currentMessageDisplay = document.getElementById('current-message-display');
            
            if (currentMessage) {
                adminCurrentMessage.textContent = currentMessage;
                currentMessageDisplay.style.display = 'block';
            } else {
                currentMessageDisplay.style.display = 'none';
            }
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ì°¸ê°€ì ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showAddParticipantForm() {
            document.getElementById('newTeam').value = '';
            document.getElementById('newEmployee').value = '';
            showModal('addParticipantModal');
        }

        async function addParticipant() {
            const team = document.getElementById('newTeam').value.trim();
            const employee = document.getElementById('newEmployee').value.trim();
            
            if (!team || !employee) {
                alert('íŒ€ëª…ê³¼ ì‚¬ë²ˆì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const id = `${team}_${employee}`;
            
            try {
                // ì¤‘ë³µ í™•ì¸
                const existingDoc = await db.collection(participantsCollection).doc(id).get();
                if (existingDoc.exists) {
                    alert('âš ï¸ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì°¸ê°€ìì…ë‹ˆë‹¤.');
                    return;
                }
                
                await db.collection(participantsCollection).doc(id).set({
                    id: id,
                    team: team,
                    employee: employee,
                    timestamp: new Date().toISOString()
                });
                
                alert('âœ… ì°¸ê°€ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeModal('addParticipantModal');
            } catch (error) {
                console.error('ì°¸ê°€ì ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('âŒ ì°¸ê°€ì ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì°¸ê°€ì ìˆ˜ì •
        function editParticipant(participantId, currentTeam, currentEmployee) {
            document.getElementById('editParticipantId').value = participantId;
            document.getElementById('editTeam').value = currentTeam;
            document.getElementById('editEmployee').value = currentEmployee;
            showModal('editParticipantModal');
        }

        async function updateParticipant() {
            const oldId = document.getElementById('editParticipantId').value;
            const newTeam = document.getElementById('editTeam').value.trim();
            const newEmployee = document.getElementById('editEmployee').value.trim();
            
            if (!newTeam || !newEmployee) {
                alert('íŒ€ëª…ê³¼ ì‚¬ë²ˆì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const newId = `${newTeam}_${newEmployee}`;
            
            try {
                // ìƒˆ IDê°€ ê¸°ì¡´ê³¼ ë‹¤ë¥´ê³  ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
                if (newId !== oldId) {
                    const existingDoc = await db.collection(participantsCollection).doc(newId).get();
                    if (existingDoc.exists) {
                        alert('âš ï¸ ìˆ˜ì •í•˜ë ¤ëŠ” íŒ€ëª…/ì‚¬ë²ˆì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
                        return;
                    }
                }
                
                // ê¸°ì¡´ ë¬¸ì„œ ì‚­ì œ
                await db.collection(participantsCollection).doc(oldId).delete();
                
                // ìƒˆ ë¬¸ì„œ ì¶”ê°€
                await db.collection(participantsCollection).doc(newId).set({
                    id: newId,
                    team: newTeam,
                    employee: newEmployee,
                    timestamp: new Date().toISOString()
                });
                
                alert('âœ… ì°¸ê°€ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeModal('editParticipantModal');
            } catch (error) {
                console.error('ì°¸ê°€ì ìˆ˜ì • ì˜¤ë¥˜:', error);
                alert('âŒ ì°¸ê°€ì ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì°¸ê°€ì ì‚­ì œ
        async function deleteParticipant(participantId) {
            if (!confirm(`âš ï¸ ì°¸ê°€ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                await db.collection(participantsCollection).doc(participantId).delete();
                alert('âœ… ì°¸ê°€ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì°¸ê°€ì ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ì°¸ê°€ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function clearAllParticipants() {
            if (!confirm('âš ï¸ ëª¨ë“  ì°¸ê°€ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const snapshot = await db.collection(participantsCollection).get();
                const batch = db.batch();
                
                snapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                alert('âœ… ëª¨ë“  ì°¸ê°€ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì°¸ê°€ì ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ì°¸ê°€ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì œì‹œë¬¸ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showAddMessageForm() {
            document.getElementById('newMessage').value = '';
            showModal('addMessageModal');
        }

        async function addMessage() {
            const newMessage = document.getElementById('newMessage').value.trim();
            
            if (!newMessage) {
                alert('ì œì‹œë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            messages.push(newMessage);
            
            const success = await saveSystemMessages();
            if (success) {
                closeModal('addMessageModal');
                alert('âœ… ì œì‹œë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                // ì‹¤íŒ¨ ì‹œ ë°°ì—´ì—ì„œ ì œê±°
                messages.pop();
                alert('âŒ ì œì‹œë¬¸ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function editMessage(index) {
            document.getElementById('editMessageId').value = index;
            document.getElementById('editMessageText').value = messages[index];
            showModal('editMessageModal');
        }

        async function updateMessage() {
            const index = parseInt(document.getElementById('editMessageId').value);
            const newText = document.getElementById('editMessageText').value.trim();
            
            if (!newText) {
                alert('ì œì‹œë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const oldMessage = messages[index];
            messages[index] = newText;
            
            const success = await saveSystemMessages();
            if (success) {
                closeModal('editMessageModal');
                alert('âœ… ì œì‹œë¬¸ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                // ì‹¤íŒ¨ ì‹œ ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                messages[index] = oldMessage;
                alert('âŒ ì œì‹œë¬¸ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteMessage(index) {
            if (!confirm(`âš ï¸ ì œì‹œë¬¸ "${messages[index].substring(0, 30)}..."ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const deletedMessage = messages.splice(index, 1)[0];
            
            const success = await saveSystemMessages();
            if (success) {
                alert('âœ… ì œì‹œë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                // ì‹¤íŒ¨ ì‹œ ì›ë˜ ìœ„ì¹˜ì— ë³µì›
                messages.splice(index, 0, deletedMessage);
                alert('âŒ ì œì‹œë¬¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function resetToDefaultMessages() {
            if (!confirm('âš ï¸ ê¸°ë³¸ ì œì‹œë¬¸ìœ¼ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ì œì‹œë¬¸ë“¤ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                return;
            }
            
            const oldMessages = [...messages];
            messages = [...defaultMessages];
            
            const success = await saveSystemMessages();
            if (success) {
                alert('âœ… ê¸°ë³¸ ì œì‹œë¬¸ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                // ì‹¤íŒ¨ ì‹œ ì›ë˜ ë©”ì‹œì§€ë¡œ ë³µì›
                messages = oldMessages;
                alert('âŒ ê¸°ë³¸ ì œì‹œë¬¸ ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë¦¬ìŠ¤ë„ˆ í•´ì œ
        window.addEventListener('beforeunload', function() {
            if (participantsUnsubscribe) {
                participantsUnsubscribe();
            }
            if (messageUnsubscribe) {
                messageUnsubscribe();
            }
            if (systemMessagesUnsubscribe) {
                systemMessagesUnsubscribe();
            }
        });
    </script>
</body>

</html>
